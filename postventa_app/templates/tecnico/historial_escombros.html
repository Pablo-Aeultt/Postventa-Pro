{% extends 'base.html' %}
{% block title %}Historial de Escombros - Técnico{% endblock %}

{% block extra_css %}
<style>
:root {
    --color-primary: #1a4d4d;
    --color-secondary: #2a6d6d;
    --color-danger: #e74c3c;
}

.card-custom {
    background: #fff;
    border-radius: 18px;
    box-shadow: 0 4px 14px rgba(0,0,0,0.08);
    border-left: 4px solid var(--color-primary);
    margin-bottom: 30px;
    overflow: hidden;
    transition: all 0.3s ease;
}

.card-header-custom {
    background: linear-gradient(135deg, var(--color-primary), var(--color-secondary));
    color: white;
    padding: 16px 24px;
    font-size: 1.2rem;
    font-weight: 600;
    display: flex;
    align-items: center;
    gap: 10px;
}

.badge-estado {
    padding: 8px 12px;
    border-radius: 8px;
    font-weight: 600;
    font-size: 0.9rem;
}

.badge-pendiente { background: #fff3cd; color: #856404; }
.badge-programado { background: #d1ecf1; color: #0c5460; }
.badge-completado { background: #d4edda; color: #155724; }
.badge-cancelado { background: #f8d7da; color: #842029; }

.tabla-escombros {
    border-collapse: collapse;
    width: 100%;
}

.tabla-escombros thead {
    background: #f8f9fa;
}

.tabla-escombros th {
    padding: 12px;
    text-align: left;
    font-weight: 600;
    color: var(--color-primary);
    border-bottom: 2px solid var(--color-primary);
}

.tabla-escombros td {
    padding: 12px;
    border-bottom: 1px solid #dee2e6;
}

.tabla-escombros tr:hover {
    background: #f8f9fa;
}

.btn-outline-primary {
    border: 2px solid var(--color-primary);
    color: var(--color-primary);
    font-weight: 600;
    border-radius: 10px;
    transition: all 0.3s ease;
}

.btn-outline-primary:hover {
    background: var(--color-primary);
    color: white;
    transform: translateY(-2px);
    box-shadow: 0 4px 12px rgba(26,77,77,0.2);
}

.filtro-estado {
    display: flex;
    gap: 8px;
    margin-bottom: 20px;
    flex-wrap: wrap;
}

.filtro-estado a {
    padding: 8px 14px;
    border-radius: 6px;
    background: #f0f0f0;
    text-decoration: none;
    color: var(--color-primary);
    font-weight: 500;
    transition: all 0.3s ease;
}

.filtro-estado a.activo {
    background: var(--color-primary);
    color: white;
}

.filtro-estado a:hover {
    background: var(--color-primary);
    color: white;
}

.sin-escombros {
    text-align: center;
    padding: 40px 20px;
    color: #999;
}

.sin-escombros i {
    font-size: 3rem;
    display: block;
    margin-bottom: 10px;
}
</style>
{% endblock %}

{% block content %}
<div class="container py-4">
  <div class="row align-items-center mb-4">
    <div class="col">
      <h4 class="mb-0"><i class="bi bi-trash"></i> Historial de Escombros</h4>
      <small class="text-muted">Gestiona el retiro de escombros de tus reclamos</small>
    </div>
    <div class="col-auto">
      <a href="{% url 'dashboard_tecnico' %}" class="btn btn-outline-primary">
        <i class="bi bi-arrow-left"></i> Volver
      </a>
    </div>
  </div>

  <!-- Filtros por estado -->
  <div class="filtro-estado mb-4">
    <a href="{% url 'tecnico_historial_escombros' %}" class="{% if not estado_filtro %}activo{% endif %}">
      <i class="bi bi-funnel"></i> Todos ({{ escombros|length }})
    </a>
    {% for code, label in estados %}
      <a href="?estado={{ code }}" class="{% if estado_filtro == code %}activo{% endif %}">
        {{ label }}
      </a>
    {% endfor %}
  </div>

  <div class="card-custom">
    <div class="card-header-custom">
      <i class="bi bi-table"></i>
      <span>Listado de Escombros</span>
    </div>
    <div class="card-body">
      {% if escombros %}
        <div class="table-responsive">
          <table class="tabla-escombros">
            <thead>
              <tr>
                <th><i class="bi bi-tag"></i> Reclamo</th>
                <th><i class="bi bi-trash2"></i> Tipo</th>
                <th><i class="bi bi-archive"></i> Volumen (m³)</th>
                <th><i class="bi bi-geo-alt"></i> Ubicación</th>
                <th><i class="bi bi-calendar"></i> Fecha Programada</th>
                <th><i class="bi bi-check-circle"></i> Estado</th>
                <th style="text-align: center;">Acciones</th>
              </tr>
            </thead>
            <tbody>
              {% for escombro in escombros %}
              <tr>
                <td>
                  <a href="{% url 'tecnico_detalle_reclamo' escombro.id_reclamo.id_reclamo %}" class="text-primary">
                    {{ escombro.id_reclamo.numero_folio }}
                  </a>
                </td>
                <td>{{ escombro.get_tipo_escombro_display }}</td>
                <td>{{ escombro.volumen_m3 }}</td>
                <td>
                  {% if escombro.ubicacion_exacta %}
                    <small>{{ escombro.ubicacion_exacta|truncatewords:8 }}</small>
                  {% else %}
                    <span class="text-muted">No especificada</span>
                  {% endif %}
                </td>
                <td>
                  {% if escombro.fecha_programada_retiro %}
                    {{ escombro.fecha_programada_retiro|date:"d/m/Y" }}
                  {% else %}
                    <span class="text-muted">No programada</span>
                  {% endif %}
                </td>
                <td>
                  <span class="badge-estado badge-{{ escombro.estado }}">
                    {{ escombro.get_estado_display }}
                  </span>
                </td>
                <td style="text-align: center;">
                  <a href="{% url 'tecnico_actualizar_escombro' escombro.id_escombro %}" class="btn btn-sm btn-outline-primary">
                    <i class="bi bi-pencil"></i> Editar
                  </a>
                </td>
              </tr>
              {% endfor %}
            </tbody>
          </table>
        </div>
      {% else %}
        <div class="sin-escombros">
          <i class="bi bi-inbox"></i>
          <h5>No hay escombros registrados</h5>
          <p class="text-muted">Cuando registres escombros en una visita, aparecerán aquí.</p>
        </div>
      {% endif %}
    </div>
  </div>
</div>
{% endblock %}
