{% extends 'base.html' %}
{% block title %}Actualizar Escombro{% endblock %}

{% block extra_css %}
<style>
:root {
    --color-primary: #1a4d4d;
    --color-secondary: #2a6d6d;
    --color-danger: #e74c3c;
}

.card-custom {
    background: #fff;
    border-radius: 18px;
    box-shadow: 0 4px 14px rgba(0,0,0,0.08);
    border-left: 4px solid var(--color-primary);
    margin-bottom: 30px;
    overflow: hidden;
}

.card-header-custom {
    background: linear-gradient(135deg, var(--color-primary), var(--color-secondary));
    color: white;
    padding: 16px 24px;
    font-size: 1.2rem;
    font-weight: 600;
    display: flex;
    align-items: center;
    gap: 10px;
}

.form-label {
    font-weight: 600;
    color: var(--color-primary);
}

.form-control:focus {
    border-color: var(--color-primary);
    box-shadow: 0 0 0 0.2rem rgba(26, 77, 77, 0.25);
}

.form-select:focus {
    border-color: var(--color-primary);
    box-shadow: 0 0 0 0.2rem rgba(26, 77, 77, 0.25);
}

.btn-success-custom {
    background: #198754;
    border: none;
    color: white;
    font-weight: 600;
    border-radius: 10px;
    transition: all 0.3s ease;
    padding: 10px 24px;
}

.btn-success-custom:hover {
    background: #157347;
    transform: translateY(-2px);
    box-shadow: 0 4px 12px rgba(25, 135, 84, 0.3);
}

.btn-outline-primary {
    border: 2px solid var(--color-primary);
    color: var(--color-primary);
    font-weight: 600;
    border-radius: 10px;
}

.btn-outline-primary:hover {
    background: var(--color-primary);
    color: white;
}

.info-box {
    background: #f8f9fa;
    padding: 16px;
    border-radius: 10px;
    border-left: 4px solid var(--color-primary);
    margin-bottom: 20px;
}

.info-fila {
    display: flex;
    padding: 8px 0;
    border-bottom: 1px solid #dee2e6;
}

.info-fila:last-child {
    border-bottom: none;
}

.info-label {
    font-weight: 600;
    color: var(--color-primary);
    min-width: 150px;
}

.info-valor {
    color: #495057;
}

.badge-estado {
    padding: 8px 12px;
    border-radius: 8px;
    font-weight: 600;
    font-size: 0.9rem;
}

.badge-pendiente { background: #fff3cd; color: #856404; }
.badge-programado { background: #d1ecf1; color: #0c5460; }
.badge-completado { background: #d4edda; color: #155724; }
.badge-cancelado { background: #f8d7da; color: #842029; }
</style>
{% endblock %}

{% block content %}
<div class="container py-4">
  <div class="row justify-content-center">
    <div class="col-lg-8">
      <div class="d-flex align-items-center justify-content-between mb-4">
        <h4 class="mb-0"><i class="bi bi-pencil-square"></i> Actualizar Escombro</h4>
        <a href="{% url 'tecnico_historial_escombros' %}" class="btn btn-outline-primary">
          <i class="bi bi-arrow-left"></i> Volver
        </a>
      </div>

      <!-- Información actual del escombro -->
      <div class="card-custom">
        <div class="card-header-custom">
          <i class="bi bi-info-circle"></i>
          <span>Información Actual</span>
        </div>
        <div class="card-body">
          <div class="info-box">
            <div class="info-fila">
              <div class="info-label"><i class="bi bi-tag"></i> Reclamo</div>
              <div class="info-valor">
                <a href="{% url 'tecnico_detalle_reclamo' escombro.id_reclamo.id_reclamo %}" class="text-primary">
                  {{ escombro.id_reclamo.numero_folio }}
                </a>
              </div>
            </div>
            <div class="info-fila">
              <div class="info-label"><i class="bi bi-trash2"></i> Tipo</div>
              <div class="info-valor">{{ escombro.get_tipo_escombro_display }}</div>
            </div>
            <div class="info-fila">
              <div class="info-label"><i class="bi bi-archive"></i> Volumen</div>
              <div class="info-valor">{{ escombro.volumen_m3 }} m³</div>
            </div>
            <div class="info-fila">
              <div class="info-label"><i class="bi bi-geo-alt"></i> Ubicación</div>
              <div class="info-valor">
                {% if escombro.ubicacion_exacta %}
                  {{ escombro.ubicacion_exacta }}
                {% else %}
                  <span class="text-muted">No especificada</span>
                {% endif %}
              </div>
            </div>
            <div class="info-fila">
              <div class="info-label"><i class="bi bi-check-circle"></i> Estado</div>
              <div class="info-valor">
                <span class="badge-estado badge-{{ escombro.estado }}">
                  {{ escombro.get_estado_display }}
                </span>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Formulario de actualización -->
      <div class="card-custom">
        <div class="card-header-custom">
          <i class="bi bi-form-check"></i>
          <span>Actualizar Información</span>
        </div>
        <div class="card-body">
          <form method="POST">
            {% csrf_token %}

            <!-- Tipo de Escombro -->
            <div class="mb-3">
              <label for="tipo_escombro" class="form-label"><i class="bi bi-tag"></i> Tipo de Escombro</label>
              <select class="form-select" id="tipo_escombro" name="tipo_escombro" required>
                <option value="">-- Seleccionar tipo --</option>
                <option value="construccion" {% if escombro.tipo_escombro == 'construccion' %}selected{% endif %}>Construcción</option>
                <option value="muebles_madera" {% if escombro.tipo_escombro == 'muebles_madera' %}selected{% endif %}>Muebles o madera</option>
                <option value="metales" {% if escombro.tipo_escombro == 'metales' %}selected{% endif %}>Metales</option>
                <option value="plasticos_carton" {% if escombro.tipo_escombro == 'plasticos_carton' %}selected{% endif %}>Plásticos / cartón</option>
                <option value="vidrio" {% if escombro.tipo_escombro == 'vidrio' %}selected{% endif %}>Vidrio</option>
                <option value="mixto" {% if escombro.tipo_escombro == 'mixto' %}selected{% endif %}>Mixto</option>
                <option value="otro" {% if escombro.tipo_escombro == 'otro' %}selected{% endif %}>Otro</option>
              </select>
            </div>



            <!-- Ubicación Exacta -->
            <div class="mb-3">
              <label for="ubicacion_exacta" class="form-label"><i class="bi bi-geo-alt"></i> Ubicación Exacta</label>
              <textarea class="form-control" id="ubicacion_exacta" name="ubicacion_exacta" rows="2"
                        placeholder="Punto exacto donde se deberán retirar los escombros...">{{ escombro.ubicacion_exacta|default:'' }}</textarea>
            </div>

            <!-- Estado -->
            <div class="mb-3">
              <label for="estado" class="form-label"><i class="bi bi-check-circle"></i> Estado</label>
              <select class="form-select" id="estado" name="estado" required>
                <option value="">-- Seleccionar estado --</option>
                <option value="pendiente" {% if 'pendiente' == escombro.estado %}selected{% endif %}>Pendiente</option>
                <option value="programado" {% if 'programado' == escombro.estado %}selected{% endif %}>Programado</option>
                <option value="completado" {% if 'completado' == escombro.estado %}selected{% endif %}>Completado</option>
                <option value="cancelado" {% if 'cancelado' == escombro.estado %}selected{% endif %}>Cancelado</option>
              </select>
            </div>

            <!-- Fecha programada -->
            <div class="mb-3">
              <label for="fecha_programada_retiro" class="form-label"><i class="bi bi-calendar-event"></i> Fecha Programada de Retiro</label>
              <input type="date" class="form-control" id="fecha_programada_retiro" name="fecha_programada_retiro" 
                     value="{% if escombro.fecha_programada_retiro %}{{ escombro.fecha_programada_retiro|date:'Y-m-d' }}{% endif %}">
            </div>







            <!-- Observaciones -->
            <div class="mb-4">
              <label for="observaciones" class="form-label"><i class="bi bi-chat-left-text"></i> Observaciones</label>
              <textarea class="form-control" id="observaciones" name="observaciones" rows="4"
                        placeholder="Detalles adicionales sobre el retiro de escombros...">{{ escombro.observaciones|default:'' }}</textarea>
            </div>

            <!-- Botones -->
            <div class="d-flex gap-2">
              <button type="submit" class="btn btn-success-custom">
                <i class="bi bi-check2-circle"></i> Guardar Cambios
              </button>
              <a href="{% url 'tecnico_historial_escombros' %}" class="btn btn-outline-primary">
                <i class="bi bi-x-circle"></i> Cancelar
              </a>
            </div>
          </form>
        </div>
      </div>
    </div>
  </div>
</div>
{% endblock %}
